<!DOCTYPE html>
<html>
<head>
    <meta charset="ISO-8859-1">
    <title>Expenses</title>
    <div data-th-replace="Link/CSS :: myCss"></div>
</head>
<body>
<div data-th-replace="/Layout/Sidebar :: mySidebar"></div>
<div class="main-content" id="panel">
    <div data-th-replace="/Layout/Navbar :: myHeader"></div>
    <div class="container-fluid mt-3" id="container">
        <div class="row">
            <h1 class="ml-3">EXPENSES</h1>
        </div>
        <div class="row">
            <div class="col-md-12">
                <div class="card">
                    <div class="row mt-3">
                        <div class="col-md-11 ml-3">
                            <a class="btn btn-primary" href="javascript:void(0)" id="recordExpance" data-toggle="modal"
                               data-target="#modal-default">RECORD EXPENSE</a>
                        </div>
                    </div>
                    <div class="row mt-3" >
                        <div class="col-md-11 ml-3">
                            <table class="table table-striped" id="expenses_table">
                                <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Price</th>
                                    <th>Date Happenned</th>
                                    <th>Action</th>
                                </tr>
                                </thead>
                                <tbody>
                                 <tr th:each="u : ${expenses}">
                                    <td><span th:utext="${u.getName()}"></span></td>
                                    <td><span th:utext="${u.getAmount()}"></span></td>
                                    <td><span th:utext="${u.getDoneAt()}"></span></td>
                                    <td></td>
                                 </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>


<!--Modal-->
<div class="modal fade" id="modal-default" tabindex="-1" role="dialog" aria-labelledby="modal-default"
     aria-hidden="true">
    <div class="modal-dialog modal- modal-dialog-centered modal-" role="document">
        <div class="modal-content">

            <div class="modal-header">
                <h6 class="modal-title" id="modal-title-default">RECORD EXPENSES</h6>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">×</span>
                </button>
            </div>

            <div class="modal-body">
                <div class="row">

                    <div class="col-md-12">
                        <div class="form-group">
                            <div class="input-group input-group-merge">
                                <div class="input-group-prepend">
                                    <span class="input-group-text"><i class="fas fa-envelope"></i></span>
                                </div>
                                <input class="form-control" placeholder="Expanse Name" type="text" id="ename">
                            </div>
                        </div>
                    </div>
                    <div class="col-md-12">
                        <div class="form-group">
                            <div class="input-group input-group-merge">
                                <div class="input-group-prepend">
                                    <span class="input-group-text"><i class="fas fa-envelope"></i></span>
                                </div>
                                <input class="form-control" placeholder="Amount" type="number" id="pprice">
                            </div>
                        </div>
                    </div>
                    <div class="col-md-12">
                        <div class="form-group">
                            <div>
                                <label for="reason">
                                    <span>Description</span>
                                </label>
                                 <textarea rows="3" class="form-control" id="reason"></textarea>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" id="saveProduct">Save changes</button>
                <button type="button" class="btn btn-link  ml-auto" data-dismiss="modal">Close</button>
            </div>
        </div>

    </div>
</div>
<div data-th-replace="/Link/Script :: myScript"></div>
<script>

    $(function () {

        $("#expenses_table").DataTable();
    })


    $(document).on("click","#saveProduct",function () {

        var product={
            "name":$("#ename").val(),
            "price":$("#pprice").val(),
            "reason":$("#reason").val()
        }

        $.ajax({
            url:'expenses/create',
            type:'POST',
            data: JSON.stringify(product),
            contentType: 'application/json',
            success:function (data) {

                if(data.code==200){
                    Swal.fire({
                        type: 'success',
                        title: 'Expense is added successfully',
                        showConfirmButton: false,
                        timer: 1500
                    })
                    setTimeout(()=>{
                        window.location.href="expenses_list"
                    },3000)
                    $("#modal-default").modal("hide");
                }else{
                    Swal.fire({
                        type: 'error',
                        title: 'Error occurred try again',
                        showConfirmButton: false,
                        timer: 1500
                    })
                }
            },
            error:function () {
                Swal.fire({
                    type: 'error',
                    title: 'Error occurred try again',
                    showConfirmButton: false,
                    timer: 1500
                })
            }
        })
    })



</script>
</body>
</html>